const DIST=[['Consumer',.7992],['Industrial',.1598],['Mil-Spec',.032],['Restricted',.0064],['Classified',.0013],['Covert',.00026],['Rare Special',.00005]];
const MULT={Consumer:[.4,.6],Industrial:[.7,1],"Mil-Spec":[1.1,1.5],Restricted:[1.5,2.5],Classified:[3,6],Covert:[8,15],"Rare Special":[30,80]};
export default class CaseSystem{constructor(config={state:null,wear:null,inventory:null}){this.state=config.state;this.wear=config.wear;this.inventory=config.inventory;this.price=2.5;this.cases=Array.from({length:12},(_,i)=>({id:i,name:'Obsidian Case '+(i+1),price:+(2.1+i*.25).toFixed(2)}));this.skins=Array.from({length:120},(_,i)=>({id:i,name:'Prototype-'+(1000+i)}))}init(){}update(){}destroy(){}pickRarity(){let r=Math.random(),c=0;for(const [k,p] of DIST){c+=p;if(r<=c)return k}return'Consumer'}genValue(r,casePrice){const [a,b]=MULT[r];return +(casePrice*(a+Math.random()*(b-a))).toFixed(2)}open(caseId,count=1){const c=this.cases.find(x=>x.id===caseId);if(!c)return[];const s=this.state.get();if(s.wallet<c.price*count)return[];const out=[];this.state.patch(st=>st.wallet-=c.price*count);for(let i=0;i<count;i++){const r=this.pickRarity();const fl=this.wear.sampleFloat();const wear=this.wear.tier(fl);const base=this.genValue(r,c.price);const value=+(base*(1-fl*.35)).toFixed(2);const skin=this.skins[Math.floor(Math.random()*this.skins.length)];const item={...skin,rarity:r,float:+fl.toFixed(4),wear,value,openedAt:Date.now()};if(r==='Rare Special')this.state.patch(st=>st.stats.rareDrops++);this.inventory.add(item);out.push(item)}return out}odds(){return DIST.map(([n,p])=>({name:n,pct:(p*100).toFixed(3)}))}}
