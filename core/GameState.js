const KEY='ccr2_state';
const D={wallet:250,vault:50,xp:0,level:1,prestige:0,inventory:[],market:{},events:[],missions:{streak:1,lastLogin:Date.now(),daily:'Open 3 cases'},stats:{wagered:0,profit:0,biggestWin:0,rtpSeries:[],games:{},rareDrops:0},profile:{username:'Operator'},provablyFair:{clientSeed:'clientseed1234',serverSeed:'serverseed1234',nonce:1,history:[]},tournament:{points:0,week:Date.now(),ai:[]},settings:{performance:true,sound:true,animations:true},behavior:{type:'Balanced',risk:0,vol:0},session:{start:Date.now(),startWallet:250}};
export default class GameState{constructor(config={}){this.config=config;this.state=this.load()}init(){this.tick=setInterval(()=>this.idle(),5000)}update(){}destroy(){clearInterval(this.tick)}load(){try{return {...D,...JSON.parse(localStorage.getItem(KEY)||'{}')}}catch{return structuredClone(D)}}save(){localStorage.setItem(KEY,JSON.stringify(this.state))}get(){return this.state}patch(fn){fn(this.state);this.save()}idle(){this.patch(s=>{const mult=1+s.prestige*0.01;s.wallet+=Math.max(0.05,0.25*mult/(1+s.wallet/20000));s.vault*=1.00004})}}
