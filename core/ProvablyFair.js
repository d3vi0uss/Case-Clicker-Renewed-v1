export default class ProvablyFair{constructor(config={state:null}){this.state=config.state}init(){}update(){}destroy(){}async hash(t){const b=new TextEncoder().encode(t);const h=await crypto.subtle.digest('SHA-256',b);return [...new Uint8Array(h)].map(v=>v.toString(16).padStart(2,'0')).join('')}async roll(game){const s=this.state.get();const n=s.provablyFair.nonce++;const input=`${s.provablyFair.clientSeed}${s.provablyFair.serverSeed}${n}`;const hash=await this.hash(input);const num=parseInt(hash.slice(0,13),16);const result=num/Math.pow(2,52);this.state.patch(st=>st.provablyFair.history.unshift({game,nonce:n,hash,result,time:Date.now()}));return result}regen(){this.state.patch(s=>{s.provablyFair.clientSeed=crypto.randomUUID().slice(0,16);s.provablyFair.serverSeed=crypto.randomUUID().slice(0,16);s.provablyFair.nonce=1})}}
